% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/trim_mod_reads.R
\name{trim_mod_reads}
\alias{trim_mod_reads}
\title{Trim methylation calls at the read ends in a ch3 database}
\usage{
trim_mod_reads(
  ch3_db,
  by_frac = 0.1,
  trim_start = FALSE,
  trim_end = TRUE,
  input_table = "calls",
  output_table = "calls_trimmed"
)
}
\arguments{
\item{ch3_db}{An object identifying the ch3 database, as accepted by
\code{MethylSeqR:::.ch3helper_connectDB()} (e.g. a file path or an
existing ch3 database object).}

\item{by_frac}{Numeric scalar between 0 and 1 (exclusive) giving the
fraction of the read length to trim from each enabled end. For
example, \code{by_frac = 0.1} trims 10\% of the read length from
the start and/or end.}

\item{trim_start}{Logical; whether to trim from the start (low
\code{read_position}) of each read.}

\item{trim_end}{Logical; whether to trim from the end (high
\code{read_position}) of each read.}

\item{input_table}{Character scalar; name of the input table
containing methylation calls (default \code{"calls"}). Must contain
at least \code{read_position} and \code{read_length} columns.}

\item{output_table}{Character scalar; name of the output table to
create/overwrite with the trimmed calls
(default \code{"calls_trimmed"}).}
}
\value{
Invisibly returns the updated \code{ch3_db} object, with
\code{current_table} set to \code{output_table}. The function is
called for its side effects of creating/replacing the trimmed table
in the database.
}
\description{
Creates a new table in a ch3 database that keeps only methylation calls
within a central fraction of each read, optionally trimming from the
start, the end, or both. Trimming is expressed as a fraction of the
read length and applied via SQL filters on `read_position`.
}
\details{
For a read of length `L` and `by_frac = f`:
\itemize{
  \item If \code{trim_start = TRUE}, positions with
        \code{read_position < L * f} are dropped.
  \item If \code{trim_end   = TRUE}, positions with
        \code{read_position >= L * (1 - f)} are dropped.
}
For example, with \code{read_length = 100} and \code{by_frac = 0.1},
positions \code{0–9} and/or \code{90–99} are trimmed depending on
which end(s) are enabled.


This function issues a \code{CREATE OR REPLACE TABLE} SQL statement
against the ch3 database. The resulting table contains a subset of
rows from \code{input_table} where the read positions fall within the
untrimmed interior region defined by \code{by_frac}, \code{trim_start},
and \code{trim_end}.

If \code{by_frac} is not strictly between 0 and 1, an error is thrown.
If both \code{trim_start} and \code{trim_end} are \code{FALSE}, the
function also errors, as there would be nothing to trim.

On success, \code{ch3_db$current_table} is updated to \code{output_table}
and a short timing message is printed.
}
\examples{
#' \dontrun{
# Trim the last 10\% of each read and write to a new table
ch3_db <- "my_sample.ch3.sqlite"

ch3_db <- trim_mod_reads(
  ch3_db       = ch3_db,
  by_frac      = 0.1,
  trim_start   = FALSE,
  trim_end     = TRUE,
  input_table  = "calls",
  output_table = "calls_trimmed_10pct_end"
)

# Trim 5\% from both the start and end of each read
ch3_db <- trim_mod_reads(
  ch3_db       = ch3_db,
  by_frac      = 0.05,
  trim_start   = TRUE,
  trim_end     = TRUE,
  input_table  = "calls",
  output_table = "calls_trimmed_5pct_both"
)
}

}
